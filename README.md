# Scaffolded Exercises

## Setup

```
git clone git@github.com:NUDelta/scaffolded-exercises.git
cd scaffolded-exercises
npm install
npm start
```

navigate to `[http://localhost:3000/1110/index.html](http://localhost:3000/1110/index.html)` to see an exact copy of an XKCD comic. Open developer tools to see more information about what's happening on the page.

## System Explanation

Scaffolded Exercises (SE) analyzes and instruments unminified source code to track variable values, order of execution, and types of code elements in order to create a series of sequenced exercises based on that source code.

### Local Variable Tracking

SE tracks the live-updating values of all variables in all scopes. It does so by creating an object we refer to going forward as a **state manager**. This so that a developer doesn't have to set a breakpoint in order to see the value of a variable.

#### `rewriteCode.js`

Deanonymizes named functions (ex: `var foo = function(x, y) { ... }` turns into `function foo(x, y) { ... }`) so that we can create a model of the nested scope structure of the program. This is important for creating the _state manager_ because we don't want two variables with the same name that are defined in different scopes to overwrite each other's values, so variables in the _state manager_ are given unique keys based on their scope (ex: a variable `bar` defined in function `foo` would be named `foo:bar` in the state manager).

-   using abstract syntax trees (ASTs) to analyze / modify source code
    -   [explore an AST without downloading anything](https://astexplorer.net/)

#### `createStateManager.js`

After the source code is modified by `rewriteCode.js` (see above^ for information on function deanonymization for scoping purposes), `createStateManager.js` creates the _state manager_ (`stateManager`) object and instruments over the modified source code in order to add in code that updates the `stateManager` object in real-time. This `stateManager` object is inputted at the top of the client-side JS file it modifies.

### WiP: Exercise Breakdown
-   using [Stacktrace](https://www.stacktracejs.com/#!/docs/stacktrace-js) to trace function calls
-   using abstract syntax trees for static code analysis to decide the amount of code to be included in a given exercise + which exercises to present earlier in the sequence (see [breakdown methodology explanation video](https://www.youtube.com/watch?v=frKHF048qSg) for more info)

## Using SE on a new site

1. Download entire site source code (including files). Save it in the sites folder @TODO add what updates should be added in the `app.js` file in order for the new site to run. May have to fix some relative src paths
2. Add StackTrace CDN link to head of HTML file:

```
<script src="https://cdnjs.cloudflare.com/ajax/libs/stacktrace.js/2.0.2/stacktrace.min.js" crossorigin="anonymous"></script>
```

3. Run `eslint` on source code to find and fix any possible syntax errors that will cause issues down the road (example: a single-line `if` statement without surrounding braces could be an issus if autogenerated code is added in that if statement). Run `npx eslint <file-or-folder-name> --fix`.
 <!-- 3. add StackTrace to HTML head -->
4. Run `node rewriteCode.js`, changing `fileKey` var to be the filename you're working on
5. Run `node createStateManager.js` changing `fileKey` var to be the filename you're working on

---

## Future considerations / questions

-   how to handle ASTs for programs with multiple JS files?
